buildscript {
  ext {
    springBootVersion = '2.1.5.RELEASE'
    springCloudVersion = 'Greenwich.SR1'
    jibVersion = '1.2.0'
    aptVersion = '0.21'
    gradleDir = "$rootProject.projectDir/gradle"
  }

  repositories {
    mavenCentral()
    gradlePluginPortal()
  }

  dependencies {
    classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
    classpath "gradle.plugin.com.google.cloud.tools:jib-gradle-plugin:${jibVersion}"
    classpath "net.ltgt.gradle:gradle-apt-plugin:${aptVersion}"
  }
}

ext {
  set('groovy.version', '2.5.6')
}

allprojects {
  repositories {
    mavenCentral()
  }
}

subprojects {
  apply plugin: 'java'
  apply plugin: 'groovy'
  apply plugin: 'org.springframework.boot'
  apply plugin: 'io.spring.dependency-management'

  sourceCompatibility = '11'
  group = 'clustercamp.springcloud'

  configurations {
    compile.exclude module: 'spring-boot-starter-tomcat'
  }

  dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.boot:spring-boot-starter-webflux")
    implementation("org.springframework.boot:spring-boot-starter-undertow")

    compileOnly "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"

    testImplementation("io.projectreactor:reactor-test")
    testImplementation("org.springframework.boot:spring-boot-starter-test")

    testImplementation "org.spockframework:spock-core:${spockVersion}"
    testImplementation "org.spockframework:spock-spring:${spockVersion}"
  }

  dependencyManagement {
    imports {
      mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
    }
  }
}

apply from: "$gradleDir/api.gradle"
apply from: "$gradleDir/jib.gradle"
apply from: "$gradleDir/mapper.gradle"
