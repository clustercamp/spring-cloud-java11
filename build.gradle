buildscript {
  ext {
    springBootVersion = "2.1.5.RELEASE"
    springCloudVersion = "Greenwich.SR1"
    gradlePath = "${rootProject.projectDir}/gradle"
    lombokPluginVersion = "3.6.4"
    gitPluginVersion = "0.12.0-rc2"
    coverallsPluginVersion = "2.8.4"
    jibVersion = "1.2.0"
  }

  repositories {
    mavenCentral()
    gradlePluginPortal()
  }

  dependencies {
    classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
    classpath "gradle.plugin.com.google.cloud.tools:jib-gradle-plugin:${jibVersion}"
    classpath "gradle.plugin.com.palantir.gradle.gitversion:gradle-git-version:${gitPluginVersion}"
//    classpath "gradle.plugin.com.github.kt3k.coveralls:coveralls-gradle-plugin:${coverallsPluginVersion}"
    classpath "io.freefair.gradle:lombok-plugin:${lombokPluginVersion}"
  }
}

allprojects {
  repositories {
    mavenCentral()
  }
}

subprojects {
  apply plugin: "java"
  apply plugin: "groovy"
  apply plugin: "org.springframework.boot"
  apply plugin: "io.spring.dependency-management"
  apply plugin: "io.freefair.lombok"

  sourceCompatibility = '11'
  group = 'clustercamp'

  configurations {
    compile.exclude module: 'spring-boot-starter-tomcat'
  }

  dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.boot:spring-boot-starter-webflux")
    implementation("org.springframework.boot:spring-boot-starter-undertow")
    implementation("org.springframework.boot:spring-boot-starter-actuator")

    annotationProcessor("org.springframework.boot:spring-boot-configuration-processor")

    testImplementation("org.springframework.boot:spring-boot-starter-test")
    testImplementation("io.projectreactor:reactor-test")
  }

  dependencyManagement {
    imports {
      mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
    }
  }
}

apply from: "${gradlePath}/api.gradle"
apply from: "${gradlePath}/jib.gradle"
apply from: "${gradlePath}/metric.gradle"
